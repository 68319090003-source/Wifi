<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Farm Dashboard</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>

<body class="bg-gray-100 font-sans min-h-screen">
<div class="container mx-auto px-4 py-10">

    <h1 class="text-3xl font-bold text-center text-green-700 mb-10">
        üåø Smart Monitor Dashboard
    </h1>

    <!-- ================= SENSOR DISPLAY ================= -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">

        <!-- Temperature -->
        <div class="bg-white rounded-xl shadow-lg p-6 text-center border-t-4 border-orange-500">
            <p class="uppercase text-gray-500 font-semibold">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</p>
            <div class="text-5xl font-bold text-orange-600 my-2">
                <span id="temp-val">--</span> ¬∞C
            </div>
            <p id="temp-status" class="text-sm font-semibold"></p>
        </div>

        <!-- Soil (% FIXED) -->
        <div class="bg-white rounded-xl shadow-lg p-6 text-center border-t-4 border-blue-500">
            <p class="uppercase text-gray-500 font-semibold">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏î‡∏¥‡∏ô</p>
            <div class="text-5xl font-bold text-blue-600 my-2">
                <span id="soil-val">--</span> %
            </div>
            <p id="soil-status" class="text-sm font-semibold"></p>
        </div>

        <!-- LDR -->
        <div class="bg-white rounded-xl shadow-lg p-6 text-center border-t-4 border-yellow-500">
            <p class="uppercase text-gray-500 font-semibold">‡πÅ‡∏™‡∏á (LDR)</p>
            <div class="text-4xl font-bold my-2" id="ldr-val">--</div>
            <p id="ldr-status" class="text-sm font-semibold"></p>
        </div>

    </div>

    <!-- ================= LIMIT SETTING ================= -->
    <div class="bg-white rounded-xl shadow-lg p-8 max-w-xl mx-auto mb-10 border-t-4 border-red-500">
        <h2 class="text-xl font-bold text-center mb-6">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

            <div>
                <label class="text-sm text-gray-600">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (¬∞C)</label>
                <input id="limit-temp" type="number"
                       class="w-full mt-1 p-2 border rounded">
            </div>

            <div>
                <label class="text-sm text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏î‡∏¥‡∏ô‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (%)</label>
                <input id="limit-soil" type="number"
                       class="w-full mt-1 p-2 border rounded">
            </div>

        </div>

        <button onclick="saveLimit()"
            class="mt-6 w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold">
            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤ Limit
        </button>
    </div>

    <!-- ================= DEVICE CONTROL ================= -->
    <div class="bg-white rounded-xl shadow-lg p-8 max-w-md mx-auto border-t-4 border-green-500">
        <h2 class="text-xl font-bold text-center mb-6">Device Control</h2>

        <div class="flex flex-col space-y-4">
            <button onclick="sendCommand('on')"
                class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg">
                ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö (LED ON)
            </button>

            <button onclick="sendCommand('off')"
                class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 rounded-lg">
                ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö (LED OFF)
            </button>
        </div>

        <div class="mt-4 text-center text-sm">
            ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="last-cmd" class="font-bold">--</span>
        </div>
    </div>

</div>

<script>
/* ================= FIREBASE ================= */
const firebaseConfig = {
    apiKey: "AIzaSy...",
    databaseURL: "https://wifi-73e6a-default-rtdb.firebaseio.com/",
    projectId: "wifi-73e6a",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ================= LIMIT ================= */
let tempLimit = 30;
let soilLimit = 30;

/* ================= SENSOR READ ================= */

// Temperature
db.ref("sensor/temp").on("value", snap => {
    const v = snap.val();
    document.getElementById("temp-val").innerText =
        v !== null ? v.toFixed(1) : "--";

    document.getElementById("temp-status").innerText =
        v >= tempLimit ? "üö® ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ" : "‡∏õ‡∏Å‡∏ï‡∏¥";
});

// üå± Soil (% FIXED)
db.ref("sensor/soil_percent").on("value", snap => {
    const v = snap.val();

    document.getElementById("soil-val").innerText =
        v !== null ? v : "--";

    document.getElementById("soil-status").innerText =
        v <= soilLimit ? "üö® ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ï‡πà‡∏≥" : "‡∏õ‡∏Å‡∏ï‡∏¥";
});

// LDR
db.ref("sensor/light").on("value", snap => {
    const v = snap.val();
    document.getElementById("ldr-val").innerText =
        v == 1 ? "üåû ‡∏™‡∏ß‡πà‡∏≤‡∏á" : "üåô ‡∏°‡∏∑‡∏î";
    document.getElementById("ldr-status").innerText = "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô";
});

/* ================= LIMIT ================= */
db.ref("limit").on("value", snap => {
    const data = snap.val();
    if (data) {
        tempLimit = data.temp;
        soilLimit = data.soil;

        document.getElementById("limit-temp").value = tempLimit;
        document.getElementById("limit-soil").value = soilLimit;
    }
});

function saveLimit() {
    const t = Number(document.getElementById("limit-temp").value);
    const s = Number(document.getElementById("limit-soil").value);

    db.ref("limit").set({
        temp: t,
        soil: s
    });

    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
}

/* ================= CONTROL ================= */
function sendCommand(cmd) {
    db.ref("control").update({ last_command: cmd });
}

db.ref("control/last_command").on("value", snap => {
    document.getElementById("last-cmd").innerText =
        snap.val() || "--";
});
</script>

</body>
</html>
