<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Farm Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body class="bg-gray-100 font-sans min-h-screen">

    <div class="container mx-auto px-4 py-10">
        <h1 class="text-3xl font-bold text-center text-green-700 mb-10">ðŸŒ¿ Smart Monitor Dashboard</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
            <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col items-center border-t-4 border-orange-500">
                <p class="text-gray-500 uppercase font-semibold">à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´</p>
                <div class="text-5xl font-bold text-orange-600 my-2">
                    <span id="temp-val">--</span> Â°C
                </div>
                <p id="temp-status" class="text-sm text-gray-400">Loading...</p>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col items-center border-t-4 border-blue-500">
                <p class="text-gray-500 uppercase font-semibold">à¸„à¹ˆà¸²à¹€à¸‹à¸™à¹€à¸‹à¸­à¸£à¹Œ (Ray/Soil)</p>
                <div class="text-5xl font-bold text-blue-600 my-2">
                    <span id="soil-val">--</span>
                </div>
                <p id="soil-status" class="text-sm text-gray-400">Loading...</p>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-8 max-w-md mx-auto border-t-4 border-green-500">
            <h2 class="text-xl font-bold text-center mb-6">Device Control</h2>
            <div class="flex flex-col space-y-4">
                <button onclick="sendCommand('on')" 
                    class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                    à¹€à¸›à¸´à¸”à¸£à¸°à¸šà¸š (LED ON)
                </button>
                <button onclick="sendCommand('off')" 
                    class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                    à¸›à¸´à¸”à¸£à¸°à¸šà¸š (LED OFF / Reset Buzzer)
                </button>
            </div>
            <div class="mt-4 text-center">
                <span class="text-sm text-gray-500">à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸¥à¹ˆà¸²à¸ªà¸¸à¸”: </span>
                <span id="last-cmd" class="text-sm font-bold text-gray-700">--</span>
            </div>
        </div>
    </div>

    <script>
        // --- à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 1: à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSy...",
            databaseURL: "https://wifi-73e6a-default-rtdb.firebaseio.com/",
            projectId: "wifi-73e6a",
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // --- à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 2: à¸­à¹ˆà¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ Sensor ---
        // à¸­à¹ˆà¸²à¸™à¸„à¹ˆà¸² Temp
        database.ref('sensor/temp').on('value', (snapshot) => {
            const val = snapshot.val();
            document.getElementById('temp-val').innerText = val ? val.toFixed(1) : "0.0";
            document.getElementById('temp-status').innerText = val >= 30 ? "âš ï¸ à¸£à¹‰à¸­à¸™à¹€à¸à¸´à¸™à¹„à¸›!" : "à¸ªà¸–à¸²à¸™à¸°à¸›à¸à¸•à¸´";
        });

        // à¸­à¹ˆà¸²à¸™à¸„à¹ˆà¸² Soil/Ray
        database.ref('sensor/soil').on('value', (snapshot) => {
            const val = snapshot.val();
            document.getElementById('soil-val').innerText = val || "0";
            document.getElementById('soil-status').innerText = val > 700 ? "âš ï¸ à¸„à¹ˆà¸²à¸ªà¸¹à¸‡à¹€à¸à¸´à¸™à¸à¸³à¸«à¸™à¸”!" : "à¸ªà¸–à¸²à¸™à¸°à¸›à¸à¸•à¸´";
        });

        // à¸­à¹ˆà¸²à¸™à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸¥à¹ˆà¸²à¸ªà¸¸à¸”
        database.ref('control/last_command').on('value', (snapshot) => {
            document.getElementById('last-cmd').innerText = snapshot.val() || "none";
        });

        // --- à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 3: à¸ªà¹ˆà¸‡à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸„à¸§à¸šà¸„à¸¸à¸¡ ---
        function sendCommand(cmd) {
            database.ref('control').update({
                last_command: cmd
            }).then(() => {
                console.log("Command sent: " + cmd);
            });
        }
    </script>
</body>
</html>
