<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Farm Dashboard</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>

<body class="bg-gray-100 min-h-screen font-sans">
<div class="container mx-auto px-4 py-10">

<h1 class="text-3xl font-bold text-center text-green-700 mb-10">
üåø Smart Monitor Dashboard
</h1>

<!-- ================= SENSOR ================= -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">

<div class="bg-white p-6 rounded-xl shadow text-center border-t-4 border-orange-500">
<p class="text-gray-500 font-semibold">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</p>
<div class="text-5xl font-bold text-orange-600">
<span id="temp-val">--</span> ¬∞C
</div>
<p id="temp-status" class="text-sm font-semibold"></p>
</div>

<div class="bg-white p-6 rounded-xl shadow text-center border-t-4 border-blue-500">
<p class="text-gray-500 font-semibold">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏î‡∏¥‡∏ô</p>
<div class="text-5xl font-bold text-blue-600">
<span id="soil-val">--</span> %
</div>
<p id="soil-status" class="text-sm font-semibold"></p>
</div>

<div class="bg-white p-6 rounded-xl shadow text-center border-t-4 border-yellow-500">
<p class="text-gray-500 font-semibold">‡πÅ‡∏™‡∏á (LDR)</p>
<div id="ldr-val" class="text-4xl font-bold">--</div>
</div>

</div>

<!-- ================= LIMIT ================= -->
<div class="bg-white p-8 rounded-xl shadow max-w-xl mx-auto mb-10 border-t-4 border-red-500">
<h2 class="text-xl font-bold text-center mb-6">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h2>

<div class="grid grid-cols-2 gap-4">
<div>
<label class="text-sm">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)</label>
<input id="limit-temp" type="number" class="w-full border p-2 rounded">
</div>
<div>
<label class="text-sm">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏î‡∏¥‡∏ô (%)</label>
<input id="limit-soil" type="number" class="w-full border p-2 rounded">
</div>
</div>

<button onclick="saveLimit()"
class="w-full mt-6 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold">
‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤ Limit
</button>

<p id="limit-msg" class="text-center text-sm mt-4"></p>
</div>

<!-- ================= DEVICE STATUS ================= -->
<div class="bg-white p-6 rounded-xl shadow max-w-xl mx-auto mb-10 border-t-4 border-purple-500">
<h2 class="text-xl font-bold text-center mb-4">üì° ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏≠‡∏£‡πå‡∏î</h2>

<p class="text-center">
‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ Limit:
<span id="limit-received" class="font-bold">--</span>
</p>

<p class="text-center mt-2">
Limit ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏ö‡∏≠‡∏£‡πå‡∏î:
<span id="device-limit" class="font-bold">--</span>
</p>
</div>

<!-- ================= CONTROL ================= -->
<div class="bg-white p-8 rounded-xl shadow max-w-md mx-auto border-t-4 border-green-500">
<h2 class="text-xl font-bold text-center mb-6">Device Control</h2>

<div class="flex flex-col space-y-4">
<button onclick="sendCommand('on')"
class="bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-bold">
‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö (LED ON)
</button>

<button onclick="sendCommand('off')"
class="bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold">
‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö (LED OFF)
</button>
</div>

<p class="text-center mt-4 text-sm">
‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="last-cmd" class="font-bold">--</span>
</p>
</div>

</div>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
apiKey: "AIzaSy...",
databaseURL: "https://wifi-73e6a-default-rtdb.firebaseio.com/",
projectId: "wifi-73e6a"
});
const db = firebase.database();

let tempLimit = 30;
let soilLimit = 30;

/* ================= SENSOR ================= */
db.ref("sensor/temp").on("value", s => {
const v = s.val();
document.getElementById("temp-val").innerText = v?.toFixed(1) || "--";
document.getElementById("temp-status").innerText =
v >= tempLimit ? "üö® ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡πà‡∏≤" : "‡∏õ‡∏Å‡∏ï‡∏¥";
});

db.ref("sensor/soil_percent").on("value", s => {
const v = s.val();
document.getElementById("soil-val").innerText = v ?? "--";
document.getElementById("soil-status").innerText =
v <= soilLimit ? "üö® ‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ" : "‡∏õ‡∏Å‡∏ï‡∏¥";
});

db.ref("sensor/light").on("value", s => {
document.getElementById("ldr-val").innerText =
s.val() == 1 ? "üåû ‡∏™‡∏ß‡πà‡∏≤‡∏á" : "üåô ‡∏°‡∏∑‡∏î";
});

/* ================= LIMIT ================= */
db.ref("limit").on("value", s => {
if (!s.val()) return;
tempLimit = s.val().temp;
soilLimit = s.val().soil;
document.getElementById("limit-temp").value = tempLimit;
document.getElementById("limit-soil").value = soilLimit;
});

function saveLimit() {
db.ref("limit").set({
temp: Number(limit-temp.value),
soil: Number(limit-soil.value)
});
document.getElementById("limit-msg").innerText =
"‚è≥ ‡∏£‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡πà‡∏≤‚Ä¶";
}

/* ================= DEVICE STATUS ================= */
db.ref("device_status").on("value", s => {
if (!s.val()) return;

document.getElementById("limit-received").innerText =
s.val().limit_received ? "‚úÖ ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß" : "‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö";

document.getElementById("device-limit").innerText =
`Temp ${s.val().limit_temp}¬∞C / Soil ${s.val().limit_soil}%`;
});

/* ================= CONTROL ================= */
function sendCommand(cmd) {
db.ref("control").update({ last_command: cmd });
}

db.ref("control/last_command").on("value", s => {
document.getElementById("last-cmd").innerText = s.val() || "--";
});
</script>

</body>
</html>
